<script>
const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const noSignal = document.getElementById('no-signal');
const ctx = overlay.getContext('2d');

function resizeOverlay() {
  overlay.width = overlay.offsetWidth;
  overlay.height = overlay.offsetHeight;
}

function drawCenterCircle() {
  ctx.clearRect(0, 0, overlay.width, overlay.height);
  const centerX = overlay.width / 2;
  const centerY = overlay.height / 2;
  const radius = Math.min(overlay.width, overlay.height) / 4;
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
  ctx.lineWidth = 3;
  ctx.strokeStyle = "black";
  ctx.stroke();
}

function pauseCamera() {
  if (video.srcObject) {
    video.srcObject.getTracks().forEach(track => track.stop());
    video.srcObject = null;
    noSignal.style.display = "flex";
  }
}

async function startCamera() {
  try {
    // スマホかどうか判定
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    const constraints = {
      video: isMobile
        ? { facingMode: { exact: "environment" } } // スマホは背面カメラ
        : true,                                    // PCはデフォルトカメラ
      audio: false
    };

    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    video.play();
    noSignal.style.display = "none";

    resizeOverlay();
    drawCenterCircle();
  } catch (err) {
    noSignal.style.display = "flex";
    video.srcObject = null;
    alert('カメラの起動に失敗しました: ' + err.message);
  }
}

window.addEventListener('resize', () => {
  resizeOverlay();
  drawCenterCircle();
});
</script>
