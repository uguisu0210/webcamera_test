あなた:
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>カメラ表示（中央円ガイド＋AF＋静止/再開＋Flask送信）</title>
<style>
  body { text-align: center; margin: 0; background: #fff; }
  #camera-container { position: relative; display: inline-block; width: 100vw; max-width: 100%; aspect-ratio: 16 / 9; background: black; }
  video, canvas, #no-signal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
  video { object-fit: cover; }
  #overlay { pointer-events: none; }
  #no-signal { display: none; align-items: center; justify-content: center; background: rgba(255,255,255,0.7); color: black; font-size: 1.2em; }
  button { margin-top: 10px; }
  #af-status { margin-top: 8px; font-size: 0.9em; color: #555; }
  #preview-dialog { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 9999; }
  #preview-box { background: #fff; padding: 15px; border-radius: 10px; text-align: center; max-width: 90%; }
  #preview-img { max-width: 100%; border: 1px solid #ccc; margin-bottom: 10px; }
  .preview-btn { margin: 5px; padding: 6px 12px; font-size: 1em; border: none; border-radius: 5px; cursor: pointer; }
  .save-btn { background: #4CAF50; color: white; }
  .cancel-btn { background: #f44336; color: white; }
  #saved-images { margin-top: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
  #saved-images img { max-width: 150px; border: 1px solid #ccc; border-radius: 4px; }
</style>
</head>
<body>

<div id="camera-container">
  <video id="video" autoplay playsinline></video>
  <canvas id="overlay"></canvas>
  <div id="no-signal">No signal</div>
</div><br>

<button id="control-btn" onclick="toggleCamera()">カメラ開始</button>
<button onclick="saveImage()">画像保存</button>
<div id="af-status">AF状態: 未確認</div>

<div id="preview-dialog">
  <div id="preview-box">
    <img id="preview-img" src="">
    <div>
      <button class="preview-btn save-btn" onclick="confirmSave()">保存する</button>
      <button class="preview-btn cancel-btn" onclick="closePreview()">キャンセル</button>
    </div>
  </div>
</div>

<h3>保存された画像（HTML内）</h3>
<div id="saved-images"></div>


<script>
// 端末IDをlocalStorageに保存し取得する関数
function getDeviceId() {
  let id = localStorage.getItem("device_id");
  if (!id) {
    // ランダムID作成
    id = "device_" + Math.random().toString(36).slice(2);
    localStorage.setItem("device_id", id);
  }
  return id;
}

// confirmSave() の fetch 部分を修正して device_id 追加
function confirmSave() {
  if (!currentImageData) {
    alert("保存する画像がありません。先に撮影してください。");
    return;
  }

  const deviceId = getDeviceId();

  console.log("[DEBUG] 画像送信開始 device_id=" + deviceId);

  fetch("https://1a3b5c12c094.ngrok-free.app/upload", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ 
      image: currentImageData,
      device_id: deviceId
    })
  })
  .then(async (res) => {
    if (!res.ok) {
      const errData = await res.json().catch(() => ({}));
      throw new Error(`HTTP ${res.status}: ${errData.message || "不明なエラー"}`);
    }
    return res.json();
  })
  .then(data => {
    if (data.status === "ok") {
      console.log("[INFO] Pythonサーバに保存しました:", data.filename);
      alert(`Pythonサーバに保存しました: ${data.filename}`);
    } else {
      throw new Error(data.message || "サーバーがエラーを返しました");
    }
  })
  .catch(err => {
    console.error("[ERROR] 送信失敗:", err);
    alert(`サーバ送信エラー: ${err.message}`);
  });

  // HTML内にも保存
  const img = document.createElement("img");
  img.src = currentImageData;
  savedImages.appendChild(img);

  closePreview();
}
</script>


